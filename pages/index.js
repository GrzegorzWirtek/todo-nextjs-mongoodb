import Head from 'next/head';
import styles from '@/styles/Home.module.css';
import { connectMongoDB } from '@/libs/mongodb/Connect';
import TaskModel from '@/libs/mongodb/TaskModel';
import Task from '@/components/Task';
import { useEffect, useState } from 'react';

export default function Home({ tasksData }) {
	const [tasks, setTasks] = useState(null);
	useEffect(() => {
		setTasks(tasksData);
	}, [tasksData]);

	return (
		<>
			<Head>
				<title>Todo Next and Mongoose app</title>
				<meta
					name='description'
					content='A todo application that uses the MngoDB Atlas database, generated by create next app'
				/>
				<meta name='viewport' content='width=device-width, initial-scale=1' />
				<link rel='icon' href='/favicon.ico' />
			</Head>
			<main className={styles.main}>
				<h1>This is home</h1>
				{tasks && tasks.map((task) => <Task key={task._id} data={task} />)}
			</main>
		</>
	);
}

export async function getStaticProps() {
	await connectMongoDB();
	const data = await TaskModel.find();
	const tasksData = JSON.parse(JSON.stringify(data));

	return {
		props: {
			tasksData,
		},
	};
}
